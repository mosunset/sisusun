{"files":[{"id":"698558ba-0911-42c0-880d-dfa19759bc44","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Tokyo\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"2774018a-cb96-4f02-8cc2-6ba7cf0bef55","name":"コード","type":"server_js","source":"function doGet(e) {\n  var template \u003d HtmlService.createTemplateFromFile(\u0027login\u0027).evaluate();\n  template.addMetaTag(\"viewport\", \"width\u003ddevice-width, initial-scale\u003d1.0, minimum-scale\u003d1.0, maximum-scale\u003d10.0\");\n  return template;\n}\n\nfunction doPost(Postdata) {\n  sheetclear()\n  var email \u003d Postdata.parameters.email.toString();\n  var password \u003d Postdata.parameters.password.toString();\n  var checkAccount \u003d judgeAccounts(email, password)\n  if (email \u003d\u003d \u0027chat@c.c\u0027){\n    const htmlOutput \u003d HtmlService.createTemplateFromFile(\"chat\");\n    var md \u003d password;\n    htmlOutput.myid \u003d md;\n    var title \u003d \"ID Error\";\n    try {\n      var myname \u003d member.getRange(Number(md), 2).getValue();\n      if (myname !\u003d \"\") {\n        title \u003d md + \" \" + myname;\n      }\n    } catch {}\n    return htmlOutput.evaluate().setTitle(title).addMetaTag(\u0027viewport\u0027, \u0027width\u003ddevice-width, initial-scale\u003d1\u0027);\n  }else if(checkAccount \u003d\u003d\u003d true) {\n    var template \u003d HtmlService.createTemplateFromFile(\u0027index\u0027);\n    template.email \u003d email;\n    template.nen \u003d notc(email,0);\n    template.kan \u003d notc(email,1);\n    template.nenc \u003d yc(email,0);\n    template.kanc \u003d yc(email,1);\n    return template.evaluate().setTitle(\"掲示板:\"+email).addMetaTag(\"viewport\", \"width\u003ddevice-width, initial-scale\u003d1.0, minimum-scale\u003d1.0, maximum-scale\u003d10.0\");\n  } else {\n    var template \u003d HtmlService.createTemplateFromFile(\u0027error\u0027);\n    template.email \u003d email;\n    template.pas \u003d password;\n    return template.evaluate().setTitle(\"ログインエラー:\"+email).addMetaTag(\"viewport\", \"width\u003ddevice-width, initial-scale\u003d1.0, minimum-scale\u003d1.0, maximum-scale\u003d10.0\");\n  }\n}\n\nvar pro \u003d PropertiesService.getScriptProperties();\n\nfunction judgeAccounts(email, password){\n  \n    return　pro.getProperty(email) \u003d\u003d\u003d password;\n\n}\n\n"},{"id":"33792122-3f20-46b4-919a-c36d1bd8b5a2","name":"sheets","type":"server_js","source":"//https://docs.google.com/spreadsheets/d/1-7G4gBYMMp5M4KW-O-aJTu90kKK2_z4GrZ1LmnZL1GM/edit#gid\u003d0\nid \u003d \"1-7G4gBYMMp5M4KW-O-aJTu90kKK2_z4GrZ1LmnZL1GM\";\nsheets \u003d SpreadsheetApp.openById(id);\nsn \u003d [\"３年生\",\"２年生\",\"１年生\",\"金管\",\"木管\",\"済み\"]\n\nfunction ce(Em){\n  var sheet \u003d sheets.getSheetByName(\"登録\");\n  var s \u003d 2;\n  while (Em !\u003d sheet.getRange(s,1).getValue()){\n    s \u003d s + 1;\n  }\n  return s;\n}\nvar t\u003d[];\nfunction notc(Em,T){\n  var sheet \u003d sheets.getSheetByName(\"登録\");\n  var s \u003d ce(Em)\n  if(T \u003d\u003d 0){\n    for(a\u003d2;a\u003c\u003d4;a++){\n      if(sheet.getRange(s,a).getValue()){\n        return sn[a-2]\n      }\n    }\n  }else if(T \u003d\u003d 1){\n    for(a\u003d5;a\u003c\u003d6;a++){\n      if(sheet.getRange(s,a).getValue()){\n        return sn[a-2]\n      }\n    }\n  }\n}\n\n//htmlタブの内容\nfunction yc(Em,T){\n  var sheet \u003d sheets.getSheetByName(\"登録\");\n  var s \u003d ce(Em)\n  var con \u003d \"\";\n  if(T \u003d\u003d 0){\n    for(a\u003d2;a\u003c\u003d4;a++){\n      if(sheet.getRange(s,a).getValue()){\n        var nen \u003d sheets.getSheetByName(sn[a-2]);\n        var low \u003d nen.getLastRow();\n        for (i\u003d2;i\u003c\u003dlow;i++){\n          con \u003d con + \u0027\u003cdiv class\u003d\"con\"\u003e\u003cspan class\u003d\"day\"\u003e\u0027+Utilities.formatDate(new Date(nen.getRange(i,1).getValue()), \u0027Asia/Tokyo\u0027, \u0027yyyy/MM/dd\u0027)+\u0027\u003c/span\u003e\u0027+nen.getRange(i,2).getValue()+\u0027\u003c/div\u003e\u0027;\n        }\n        return con\n      }\n    }\n  }else if(T \u003d\u003d 1){\n    for(a\u003d5;a\u003c\u003d6;a++){\n      if(sheet.getRange(s,a).getValue()){\n        var nen \u003d sheets.getSheetByName(sn[a-2]);\n        var low \u003d nen.getLastRow();\n        for (i\u003d2;i\u003c\u003dlow;i++){\n          con \u003d con + \u0027\u003cdiv class\u003d\"con\"\u003e\u003cspan class\u003d\"day\"\u003e\u0027+Utilities.formatDate(new Date(nen.getRange(i,1).getValue()), \u0027Asia/Tokyo\u0027, \u0027yyyy/MM/dd\u0027)+\u0027\u003c/span\u003e\u0027+nen.getRange(i,2).getValue()+\u0027\u003c/div\u003e\u0027;\n        }\n        return con\n      }\n    }\n  }\n}\n\n//sheetの整列\nvar time \u003d new Date;\nfunction sheetclear(){\n  var s5 \u003d sheets.getSheetByName(sn[5])\n  for (i \u003d 1;i\u003c\u003d5;i++){\n    var sheet \u003d sheets.getSheetByName(sn[i-1]);\n    var low \u003d sheet.getLastRow();\n\n    for (a \u003d 2;a\u003c\u003dlow;a++){\n      var d \u003d Utilities.formatDate( new Date(sheet.getRange(a,1).getValue()), \u0027Asia/Tokyo\u0027, \u0027yyyyMMdd\u0027);\n      d \u003d d - Utilities.formatDate( time, \u0027Asia/Tokyo\u0027, \u0027yyyyMMdd\u0027);\n\n      if(d \u003c 0){\n        var slow \u003d s5.getLastRow();\n        s5.getRange(slow+1,1).setValue(sheet.getRange(a,1).getValue());\n        s5.getRange(slow+1,2).setValue(sheet.getRange(a,2).getValue());\n        s5.getRange(slow+1,3).setValue(sn[i-1]);\n        sheet.deleteRow(a)        \n      }\n\n    }\n    sheet.getRange(2,1,sheet.getLastRow(),2).sort({column:1,ascending:true});\n  }\n  var slow \u003d s5.getLastRow();\n  s5.getRange(2,1,slow,3).sort({column:1,ascending:false});\n}\n\n\n\n\n"},{"id":"d06015eb-8595-48a0-a77e-32dd0c8cdaf0","name":"index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027indexcss\u0027).getContent(); ?\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"email\"\u003e\u003c?\u003d email ?\u003e\u003c/div\u003e\n\n    \u003cdiv class\u003d\"tabs\"\u003e\n        \u003cinput id\u003d\"gakunen\" type\u003d\"radio\" name\u003d\"tab_item\" checked\u003d\"checked\"\u003e\n        \u003clabel class\u003d\"tab_item\" for\u003d\"gakunen\"\u003e\u003c?\u003d nen ?\u003e\u003c/label\u003e\n        \u003cinput id\u003d\"syurui\" type\u003d\"radio\" name\u003d\"tab_item\"\u003e\n        \u003clabel class\u003d\"tab_item\" for\u003d\"syurui\"\u003e\u003c?\u003d kan ?\u003e\u003c/label\u003e\n        \u003cdiv class\u003d\"tab_content\" id\u003d\"gakunen_content\"\u003e\n            \u003cdiv class\u003d\"tab_content_description\"\u003e\n              \u003cscript\u003edocument.write(\u003c?\u003d nenc ?\u003e)\u003c/script\u003e\n              \u003c!--\u003cdiv class\u003d\"con\"\u003e\u003cspan class\u003d\"day\"\u003e2021/12/26\u003c/span\u003e緊急休校\u003c/div\u003e\n                \u003cdiv class\u003d\"con\"\u003e\u003cspan class\u003d\"day\"\u003e2021/5/30\u003c/span\u003eコンクールオーディション\u003c/div\u003e--\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"tab_content\" id\u003d\"syurui_content\"\u003e\n            \u003cdiv class\u003d\"tab_content_description\"\u003e\n              \u003cscript\u003edocument.write(\u003c?\u003d kanc ?\u003e)\u003c/script\u003e\n              \u003c!--\u003cdiv class\u003d\"con\"\u003e\u003cspan class\u003d\"day\"\u003e2021/11/23\u003c/span\u003e通常投稿\u003c/div\u003e\n                \u003cdiv class\u003d\"con\"\u003e\u003cspan class\u003d\"day\"\u003e2021/8/10\u003c/span\u003eアンサンブルコンテスト\u003c/div\u003e--\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"ee1f03ba-9d6d-439a-97db-d05cb947e95a","name":"indexcss","type":"html","source":"\u003cstyle\u003e\n    @media screen and (max-width: 480px){\n      body {\n        width: 92%;\n        margin: 0 auto;\n        padding: 15px;\n      }\n      .con {\n        border: 1px solid #999;\n        border-radius: 10px;\n        padding: 10px;\n        margin: 5px;\n        font-size: large;\n      }\n      .tab_content {\n      display: none;\n      padding: 10px 10px 0;\n      clear: both;\n      overflow: hidden;\n    }\n    }\n    @media screen and (min-width: 481px){\n      body {\n        width: 70%;\n        margin: 0 auto;\n        padding: 15px;\n      }\n      .con {\n        border: 1px solid #999;\n        border-radius: 10px;\n        padding: 10px;\n        margin: 5px;\n        \n        \n      }\n      .tab_content {\n      display: none;\n      padding: 40px 40px 0;\n      clear: both;\n      overflow: hidden;\n      }\n    }\n\n    .email {\n      text-align: center;\n      font-size: larger;\n      margin-bottom: 15px;\n      padding: 0.4em 0.5em;\n      color: #494949;\n      background: #f4f4f4;\n      border-left: solid 5px #7db4e6;\n      border-bottom: solid 3px #d7d7d7;\n    }\n\n    .email::after {\n      content: \" さんの掲示板\";\n    }\n\n    \n\n    .day {\n      padding-left: 10px;\n      display: inline-block;\n      min-width: 100px;\n      width: 25%;\n    }\n\n    .day::after {\n      content: \" \";\n    }\n\n    .tabs {\n      margin-top: 50px;\n      padding-bottom: 40px;\n      background-color: #fff;\n      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);\n      width: 100%;\n      margin: 0 auto;\n    }\n\n    .tab_item {\n      width: calc(100%/2);\n      height: 50px;\n      border-bottom: 3px solid #5ab4bd;\n      background-color: #d9d9d9;\n      line-height: 50px;\n      font-size: 16px;\n      text-align: center;\n      color: #565656;\n      display: block;\n      float: left;\n      font-weight: bold;\n      transition: all 0.2s ease;\n    }\n\n    .tab_item:hover {\n      opacity: 0.75;\n    }\n\n    input[name\u003d\"tab_item\"] {\n      display: none;\n    }\n\n    #gakunen:checked~#gakunen_content,\n    #syurui:checked~#syurui_content {\n      display: block;\n    }\n\n    .tabs input:checked+.tab_item {\n      background-color: #5ab4bd;\n      color: #fff;\n    }\n  \u003c/style\u003e"},{"id":"80fd2b4b-5fa4-4dec-8bf1-9e452b0ab67e","name":"error","type":"html","source":"\u003c!DOCTYPE html\u003e\r\n\u003chtml\u003e\r\n  \u003chead\u003e\r\n    \u003cbase target\u003d\"_top\"\u003e\r\n  \u003c/head\u003e\r\n  \u003cbody bgcolor\u003d\"#e9e9e9\"\u003e\r\n    \u003ch1\u003eアクセス権限のないユーザーです。\u003c/h1\u003e\r\n    \u003ch2\u003eログインできませんでした\u003c/h2\u003e\r\n    \u003ch2\u003eメールアドレス：\u003c?\u003d email ?\u003e\u003c/h2\u003e\r\n    \u003ch2\u003eパスワード：\u003c?\u003d pas ?\u003e\u003c/h2\u003e\r\n  \u003c/body\u003e\r\n\u003c/html\u003e\r\n"},{"id":"e3407d22-5c21-4e77-9ad7-ad8854aedc52","name":"login","type":"html","source":"\u003c!DOCTYPE html\u003e\r\n\u003chtml\u003e\r\n  \u003chead\u003e\r\n    \u003cbase target\u003d\"_top\"\u003e\r\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027logincss\u0027).getContent(); ?\u003e\r\n  \u003c/head\u003e\r\n  \u003cbody\u003e\r\n    \u003cdiv class\u003d\"form-wrapper\"\u003e\r\n      \u003ch1\u003eLogin\u003c/h1\u003e\r\n      \u003cform id\u003d\"Wait\" method\u003d\"post\" target\u003d\"_blank\" action\u003d\"https://script.google.com/macros/s/AKfycbxC2O5DATdcRKtADlamMGVOK58UO48QtOsccDmQydjWOraJ0gOoMszU8cGfOGdcqTeU/exec\"\u003e\r\n        \u003cdiv class\u003d\"form-item\"\u003e\r\n          \u003clabel for\u003d\"email\"\u003e\u003c/label\u003e\r\n          \u003cinput type\u003d\"email\" name\u003d\"email\" required\u003d\"required\" placeholder\u003d\"メールアドレス\"\u003e\u003c/input\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class\u003d\"form-item\"\u003e\r\n          \u003clabel for\u003d\"password\"\u003e\u003c/label\u003e\r\n          \u003cinput type\u003d\"password\" name\u003d\"password\" required\u003d\"required\" placeholder\u003d\"パスワード\"\u003e\u003c/input\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class\u003d\"button-panel\"\u003e\r\n          \u003cinput type\u003d\"submit\" class\u003d\"button\" title\u003d\"Login\" value\u003d\"Login\" onclick\u003d\"history.back()\"\u003e\u003c/input\u003e\r\n        \u003c/div\u003e\r\n      \u003c/form\u003e\r\n      \u003cdiv class\u003d\"form-footer\"\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  \u003c/body\u003e\r\n\u003c/html\u003e\r\n"},{"id":"33084d8c-004b-428a-8feb-e3b71920d755","name":"logincss","type":"html","source":"\u003cstyle type\u003d\"text/css\"\u003e\n/* Fonts */\n@import url(https://fonts.googleapis.com/css?family\u003dOpen+Sans:400);\n\n/* fontawesome */\n@import url(http://weloveiconfonts.com/api/?family\u003dfontawesome);\n[class*\u003d\"fontawesome-\"]:before {\n  font-family: \u0027FontAwesome\u0027, sans-serif;\n}\n\n/* Simple Reset */\n* { margin: 0; padding: 0; box-sizing: border-box; }\n\n/* body */\nbody {\n  background: #eee;\n  color: #5e5e5e;\n  font: 400 87.5%/1.5em \u0027Open Sans\u0027, sans-serif;\n}\n\n/* Form Layout */\n.form-wrapper {\n  background: #fafafa;\n  margin: 3em auto;\n  padding: 0 1em;\n  max-width: 370px;\n}\n\nh1 {\n  text-align: center;\n  padding: 1em 0;\n}\n\nform {\n  padding: 0 1.5em;\n}\n\n.form-item {\n  margin-bottom: 0.75em;\n  width: 100%;\n}\n\n.form-item input {\n  background: #fafafa;\n  border: none;\n  border-bottom: 2px solid #e9e9e9;\n  color: #666;\n  font-family: \u0027Open Sans\u0027, sans-serif;\n  font-size: 1em;\n  height: 50px;\n  transition: border-color 0.3s;\n  width: 100%;\n}\n\n.form-item input:focus {\n  border-bottom: 2px solid #c0c0c0;\n  outline: none;\n}\n\n.button-panel {\n  margin: 2em 0 0;\n  width: 100%;\n}\n\n.button-panel .button {\n  background: #f16272;\n  border: none;\n  color: #fff;\n  cursor: pointer;\n  height: 50px;\n  font-family: \u0027Open Sans\u0027, sans-serif;\n  font-size: 1.2em;\n  letter-spacing: 0.05em;\n  text-align: center;\n  text-transform: uppercase;\n  transition: background 0.3s ease-in-out;\n  width: 100%;\n}\n\n.button:hover {\n  background: #ee3e52;\n}\n\n.form-footer {\n  font-size: 1em;\n  padding: 2em 0;\n  text-align: center;\n}\n\n.form-footer a {\n  color: #8c8c8c;\n  text-decoration: none;\n  transition: border-color 0.3s;\n}\n\n.form-footer a:hover {\n  border-bottom: 1px dotted #8c8c8c;\n}    \n\u003c/style\u003e\n"},{"id":"0a3eacdf-b174-481c-a838-c245d76a7a30","name":"chat","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"ja\"\u003e\n\n\u003chead\u003e\n  \u003cmeta charset\u003d\"UTF-8\"\u003e\n  \u003cmeta http-equiv\u003d\"X-UA-Compatible\" content\u003d\"IE\u003dedge\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\"\u003e\n  \u003clink href\u003d\"https://fonts.googleapis.com/icon?family\u003dMaterial+Icons\" rel\u003d\"stylesheet\"\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003ctitle\u003eテスト\u003c/title\u003e\n  \u003cstyle\u003e\n    * {\n      /*border: 0.2px solid red;*/\n      margin: 0;\n      padding: 0;\n    }\n\n    body {\n      min-width: 650px;\n    }\n\n    #main {\n      display: flex;\n      height: 100vh;\n    }\n\n    #friends_list {\n      width: 30%;\n      height: 100%;\n      overflow-y: scroll;\n    }\n\n    ul {\n      padding: 10px;\n    }\n\n    #select_name,\n    li {\n      list-style-type: none;\n      margin: 10px 5px;\n      padding: 5px;\n      border-radius: 5px;\n      color: #fff;\n      border: 2px solid #c55505;\n      background-color: #c55505;\n      text-align: center;\n    }\n\n    li:first-of-type {\n      margin-top: 58px;\n    }\n\n    #select_name {\n      color: #000;\n      background-color: #fff;\n      position: fixed;\n      width: 25.5%;\n    }\n\n    li:hover {\n      color: #fff;\n      background: #ff6b02;\n    }\n\n    #chat {\n      width: 70%;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-between;\n    }\n\n    #talk {\n      margin: 15px 15px 0 15px;\n      padding: 10px;\n      border: 1px solid gray;\n      border-radius: 5px;\n      overflow-y: scroll;\n      display: flex;\n      flex-wrap: nowrap;\n      flex-direction: column;\n      height: 100%;\n    }\n\n    .he,\n    .my {\n      display: table;\n      padding: 5px;\n      border-radius: 3px;\n      margin-top: 2px;\n      margin-bottom: 2px;\n    }\n\n    .he {\n      margin-right: auto;\n      background-color: rgba(211, 211, 211, 0.5);\n    }\n\n    .my {\n      margin-left: auto;\n      background-color: rgba(11, 192, 11, 0.5);\n    }\n\n    #mycontents {\n      padding: 10px;\n      border: 1px solid gray;\n      background-color: rgb(230, 216, 216);\n      border-radius: 5px;\n      display: flex;\n      margin: 15px;\n    }\n\n    #text {\n      flex-grow: 8;\n      margin-right: 10px;\n    }\n\n    #textbox {\n      width: 100%;\n      height: 80%;\n    }\n\n    #send {\n      flex-grow: 1;\n      text-align: center;\n      background-color: rgb(160, 252, 221);\n      border-radius: 10px;\n    }\n    .load {\n      text-align: center;\n    }\n  \u003c/style\u003e\n\u003c/head\u003e\n\n\u003cbody\u003e\n    \u003cdiv id\u003d\"main\"\u003e\n        \u003cdiv id\u003d\"friends_list\"\u003e\n        \u003c/div\u003e\n        \u003cdiv id\u003d\"chat\"\u003e\n            \u003cdiv id\u003d\"talk\"\u003e\n              \u003cdiv class\u003d\"load\"\u003e友達を選択してください\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv id\u003d\"mycontents\"\u003e\n                \u003cdiv id\u003d\"text\"\u003e\u003cinput type\u003d\"text\" id\u003d\"textbox\"\u003e\u003c/div\u003e\n                \u003cdiv id\u003d\"send\" class\u003d\"send\" onclick\u003d\"send();\"\u003e\n                    \u003cspan class\u003d\"material-icons\" style\u003d\"font-size:20px; vertical-align: middle;\"\u003e\n                        send\n                    \u003c/span\u003e\n                    送信\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n  \u003cdiv id\u003d\"myid\" Style\u003d\"display:none;\"\u003e\u003c?\u003dmyid?\u003e\u003c/div\u003e\n  \u003cdiv id\u003d\"youid\" Style\u003d\"display:none;\"\u003e\u003c/div\u003e\n  \u003cscript type\u003d\"text/javascript\"\u003e\n  var myid;\n  window.addEventListener(\u0027load\u0027, function () {\n    myid \u003d document.getElementById(\u0027myid\u0027).textContent;\n    console.log(isNaN(myid));\n    if(!isNaN(myid) \u0026\u0026 myid \u003d\u003d \"\" \u0026\u0026 myid \u003d\u003d 0){\n      alert(\"パスワードの欄にMyIDを入力してください\")\n    }else{\n      document.getElementById(\u0027friends_list\u0027).innerHTML \u003d\u0027\u003cdiv class\u003d\"load\"\u003e読み込んでいます\u003c/div\u003e\u0027;\n      google.script.run.withSuccessHandler(listupdate).namelist(myid);\n    } \n  });\n  function listupdate(data) {\n    document.getElementById(\u0027friends_list\u0027).innerHTML \u003d data;\n  }\n  var id;\n  function liclick(e) {\n    id \u003d e.id;\n    myid \u003d document.getElementById(\u0027myid\u0027).textContent;\n    document.getElementById(\u0027youid\u0027).textContent \u003d \"\";\n    document.getElementById(\u0027youid\u0027).textContent \u003d id;\n    var st \u003d e.innerHTML;\n    document.getElementById(\u0027talk\u0027).innerHTML \u003d \u0027\u003cdiv class\u003d\"load\"\u003e\u0027 + st + \u0027 とのトークを読み込んでいます\u003c/div\u003e\u0027;\n    console.log(\"test\");\n    document.getElementById(\u0027select_name\u0027).innerHTML \u003d st;//id + \" : \" + st;\n    google.script.run.withSuccessHandler(talkupdate).taog(id,myid);\n  }\n  \n  function talkupdate(talkdata){\n    document.getElementById(\u0027talk\u0027).innerHTML \u003d \"\";\n    document.getElementById(\u0027talk\u0027).innerHTML \u003d talkdata;\n    const el \u003d document.getElementById(\u0027talk\u0027);\n    el.scrollTo(0, el.scrollHeight);\n  }\n\n  function send(){\n    var message \u003d document.getElementById(\u0027textbox\u0027).value;\n    document.getElementById(\u0027textbox\u0027).value \u003d \"\";\n    myid \u003d document.getElementById(\u0027myid\u0027).textContent;\n    id \u003d document.getElementById(\u0027youid\u0027).textContent;\n    if(message \u003d\u003d \"\"){\n      google.script.run.withSuccessHandler(talkupdate).taog(id,myid);\n    }else{\n      google.script.run.withSuccessHandler(talkupdate).send(message,myid,id);\n    }\n  }\n\u003c/script\u003e\n\u003c/body\u003e\n\n\u003c/html\u003e"},{"id":"a5a9b11b-c1db-4466-91ae-175f76ff00b0","name":"chatindex","type":"server_js","source":"var pro \u003d PropertiesService.getScriptProperties();\n//https://docs.google.com/spreadsheets/d/1UIpslOpgeUQ3Yc_n7OWs8oM6uUeZ098X3lA9yt3Fs1Q/edit?usp\u003dsharing\nlet ss \u003d SpreadsheetApp.openById(\"1UIpslOpgeUQ3Yc_n7OWs8oM6uUeZ098X3lA9yt3Fs1Q\");\nlet member \u003d ss.getSheets()[0];\nlet c \u003d member.getLastRow();\n\nfunction namelist(m) {\n  var list \u003d \"\";\n  men \u003d Number(m);\n  let se \u003d ss.getSheets()[men];\n  var n \u003d se.getRange(1, 1).getNextDataCell(SpreadsheetApp.Direction.NEXT).getColumn();\n  for (let i \u003d 1; i \u003c\u003d n; i +\u003d 2) {\n    var id \u003d se.getRange(1, i).getValue();\n    list \u003d list + \u0027\u003cli id\u003d\"\u0027 + id + \u0027\" onclick\u003d\"liclick(this);\"\u003e\u0027 + id + \" \" + se.getRange(1, i + 1).getValue() + \u0027\u003c/li\u003e\u0027;\n  }\n  list \u003d \u0027\u003cul\u003e\u003cdiv id\u003d\"select_name\"\u003enone\u003c/div\u003e\u0027 + list + \u0027\u003c/ul\u003e\u0027;\n  return list;\n}\n\nfunction taog(d, m) {\n  var talk \u003d \"\";\n  men \u003d Number(m);\n  let se \u003d ss.getSheets()[men];\n  let i;\n  for (i \u003d 1; i \u003c\u003d 30; i +\u003d 2) {\n    if (d \u003d\u003d se.getRange(1, i).getValue()) {\n      break;\n    }\n  }\n  Logger.log(i);\n  var cs \u003d se.getRange(1, i).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow();\n  Logger.log(cs);\n  if (cs \u003e\u003d 1000) {\n    cs \u003d 1;\n    talk \u003d \u0027\u003cdiv class\u003d\"load\"\u003eトーク履歴はありません\u003c/div\u003e\u0027;\n  }else{\n    for (let j \u003d 2; j \u003c\u003d cs; j++) {\n      if (0 \u003d\u003d se.getRange(j, i).getValue()) {\n        talk \u003d talk + \u0027\u003cdiv class\u003d\"my\"\u003e\u0027 + se.getRange(j, i + 1).getValue() + \u0027\u003c/div\u003e\u0027;\n      } else {\n        talk \u003d talk + \u0027\u003cdiv class\u003d\"he\"\u003e\u0027 + se.getRange(j, i + 1).getValue() + \u0027\u003c/div\u003e\u0027;\n      }\n    }\n  }\n  \n  \n  //Logger.log(talk)\n  return talk;\n}\n\nfunction send(message, myid, youid) { //0が自分　1が相手\n  let my \u003d ss.getSheets()[myid]; //自分側の処理\n  let i;\n  for (i \u003d 1; i \u003c\u003d 30; i +\u003d 2) {\n    if (youid \u003d\u003d my.getRange(1, i).getValue()) {\n      break;\n    }\n  }\n  var cs \u003d my.getRange(1, i).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow();\n  if (cs \u003e\u003d 1000) {\n    cs \u003d 1;\n  }\n  my.getRange(cs + 1, i).setValue(0);\n  my.getRange(cs + 1, i + 1).setValue(message);\n  let u \u003d ss.getSheets()[youid]; //相手側の処理\n\n  for (i \u003d 1; i \u003c\u003d 30; i +\u003d 2) {\n    if (myid \u003d\u003d u.getRange(1, i).getValue()) {\n      break;\n    }\n  }\n  var cs \u003d u.getRange(1, i).getNextDataCell(SpreadsheetApp.Direction.DOWN).getRow();\n  if (cs \u003e\u003d 1000) {\n    cs \u003d 1;\n  }\n  u.getRange(cs + 1, i).setValue(1);\n  u.getRange(cs + 1, i + 1).setValue(message);\n  return taog(youid,myid);\n}\n\n\n\n\n\n"},{"id":"164d12d3-ba2f-4ae2-85c3-71de81d71dc3","name":"chatテストデータ作成","type":"server_js","source":"function createsheet() {\n  Logger.log(c);\n  for (let i \u003d 1; i \u003c\u003d c; i++) {\n    var id \u003d member.getRange(i, 1).getValue();\n    var name \u003d member.getRange(i, 2).getValue();\n    let newSheet \u003d ss.insertSheet();\n    newSheet.setName(id +\" \"+ name);\n  }\n}\n\nfunction testdatacreation() {\n  //一人の人\n  for (let i \u003d 1; i \u003c\u003d c; i++) {\n    var n \u003d member.getRange(i, 1).getNextDataCell(SpreadsheetApp.Direction.NEXT).getColumn();\n    var oneh \u003d ss.getSheets()[i];\n    var ones \u003d 1;\n    Logger.log(i);\n    //その人の友達\n    for (let j \u003d 5; j \u003c\u003d n; j++) {\n      var id \u003d member.getRange(i, j).getValue();\n      //idから名前の探索\n      for (let k \u003d 1; k \u003c\u003d c; k++) {\n        if (id \u003d\u003d member.getRange(k, 1).getValue()) {\n          var name \u003d member.getRange(k, 2).getValue();\n          Logger.log(name);\n        }\n      }\n      //シートへの書き込みid名前\n      oneh.getRange(1, ones).setValue(id);\n      oneh.setColumnWidth(ones, 25)\n      oneh.getRange(1, ones + 1).setValue(name);\n      oneh.setColumnWidth(ones + 1, 150);\n      //ランダムなトークデータの作成\n      var talk \u003d Math.floor(Math.random() * 30 + 5);\n      for (let t \u003d 2; t \u003c\u003d talk; t++) {\n        var talh \u003d Math.floor(Math.random() * 2);\n        //oneh.getRange(t, ones).setValue(talh);\n        //oneh.getRange(t, ones + 1).setValue(randomtext());\n      }\n      ones +\u003d 2;\n    }\n  }\n}\n\nfunction randomtext() {\n  // 生成する文字列の長さ\n  var l \u003d Math.floor(Math.random() * 10 + 5);\n  // 生成する文字列に含める文字セット\n  var c \u003d \"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをんabcdefghijklmnopqrstuvwxyz0123456789\";\n  var cl \u003d c.length;\n  var r \u003d \"\";\n  for (var i \u003d 0; i \u003c l; i++) {\n    r +\u003d c[Math.floor(Math.random() * cl)];\n  }\n  return r;\n}\n\nfunction sheetdeleat() {\n  var i \u003d 1;\n  while (i \u003c 30) {\n    try {\n      ss.deleteSheet(ss.getSheets()[i]);\n      i++;\n    } catch {\n      break;\n    }\n  }\n}"}]}